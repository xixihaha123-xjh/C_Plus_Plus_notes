# sip协议抓包分析

参考网址：

[wireshark抓包分析sip流程]: https://blog.csdn.net/u014257614/article/details/23456107

[sip协议原理 ]: https://wenku.baidu.com/view/881eda627e21af45b307a861.html



# 1 wireshark抓包分析

## 1.1 呼叫流程

![wireshark抓包分析sip流程1](pic\wireshark抓包分析sip流程1.png)



![wireshark抓包分析sip流程4.png](pic\wireshark抓包分析sip流程4.png)



## 1.2 请求行

![wireshark抓包分析sip流程2](pic\wireshark抓包分析sip流程2.png)

## 1.3 状态行

![wireshark抓包分析sip流程3 ](pic\wireshark抓包分析sip流程3.png)



# 2 sip简介



# 3 sip协议涉及到的消息类型

## 3.1 请求消息

### 3.1.1 请求消息

| 请求消息 | 消息含义                                                     |
| -------- | ------------------------------------------------------------ |
| INVITE   | 发起会话请求，用于邀请用户或服务参加一个会话                 |
| ACK      | 证实已收到对于INVITE请求的最终响应。该消息仅和INVITE消息配套使用 |
| BYE      | 结束会话                                                     |
| CANCEL   | 取消尚未完成的请求，对于已完成的请求则没有影响               |
| REGISTER | 注册                                                         |
| OPTIONS  | 查询服务器能力                                               |

### 3.1.2 消息体格式

<img src="pic\01-sip协议请求消息.png" style="zoom:20%;" />

### 3.1.3 SIP消息头字段：

* call-ID：唯一标识特定邀请或某个客户机的注册请求消息
* From：请求的发起者
* To：请求的目的接收方
* Cseq：标识服务器发出的的不同请求，若Call-ID相同Cseq值必须各不相同
* via：字段给出请求消息迄今为止经过的路径
* contact：给出一个URL，用户可以根据此URL进一步通讯
* Max-Forwards：请求消息允许被转发的次数
* Allow：
* Content-Length：消息体的大小
* supported：
* user-Agent：发起请求的用户代理客户及相关信息
* Content-type：消息体的媒体类型
* session-Expires：会话中止/过期

* 空行表示消息头结束

### 3.1.4 sip消息体

| 字符 | 含义                   |
| ---- | ---------------------- |
| v    | 协议的版本             |
| o    | 与会话所有者的相关参数 |
| s    | 会话标题或会话名称     |
| c    | 真正流媒体使用的IP地址 |
| t    | 真正流媒体使用的IP地址 |
| m    | 真正流媒体使用的IP地址 |
| a    | 真正流媒体使用的IP地址 |

## 3.2 响应消息

1. SIP 状态码

| 序号 | 状态码                   | 消息功能                                                     |
| ---- | ------------------------ | ------------------------------------------------------------ |
| 1xx  | 信息响应（呼叫进展响应） | 表示已经接收到的请求消息，正在对其进行处理                   |
| 2xx  | 成功响应                 | 表示请求已经被成功接受、处理                                 |
| 3xx  | 重定向响应               | 表示需要采取进一步动作，以完成该请求                         |
| 4xx  | 客户出错                 | 表示请求消息中包含语法错误或者SIP服务器不能完成对该请求消息处理 |
| 5xx  | 服务器出错               | 表示SIP服务器故障不能完成对正确消息的处理                    |
| 6xx  | 全局故障                 | 表示请求不能在任何SIP服务器上实现                            |

2. 消息体格式

<img src="pic\02-sip协议响应消息.png" alt="02-sip协议响应消息" style="zoom:20%;" />





# 4  sip协议流程

## 4.1 注册



## 4.2 呼叫



